import{c as K,j as e}from"./createLucideIcon-BVK-TNov.js";import{r as i}from"./router-CzIOuVrz.js";import{u as L,B as b,d as h}from"./button-B9rjGe4R.js";import{T as J}from"./textarea-D1VqTvES.js";import{q as C,o as Q,w as A,c as y,f as M,h as _,d as q,b as O}from"./firebase-DxUWQnlV.js";import{M as F}from"./message-square-ryBRVS0s.js";import{C as V}from"./circle-alert-BrtdaKy3.js";import{U as G}from"./user-MkBF9CLd.js";import{S as H,a as W}from"./shield-BB2ib7Ia.js";import{C as X}from"./clock-DTOIgMDV.js";import"./vendor-Csw2ODfV.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ee=K("info",Y);function xe(){const{user:t}=L(),[p,N]=i.useState([]),[o,u]=i.useState(""),[I,f]=i.useState(!0),[d,w]=i.useState(!1),[g,P]=i.useState(null),[k,a]=i.useState(null),D=i.useRef(null),T=()=>{var s;(s=D.current)==null||s.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{T()},[p]),i.useEffect(()=>{(async()=>{if(t)try{const r=await _(q(h,"users",t.uid));if(r.exists()){const n=r.data();P(n)}else a("Uživatelská data nenalezena. Zkuste se znovu přihlásit.")}catch(r){console.error("Error loading user data:",r),a("Chyba při načítání uživatelských dat: "+r.message)}})()},[t]),i.useEffect(()=>{if(!t)return;const s=C(y(h,"messages"),A("userId","==",t.uid),Q("createdAt","asc")),r=M(s,n=>{const c=[];n.forEach(v=>{c.push({id:v.id,...v.data()})}),N(c),f(!1),a(null)},n=>{if(console.error("Messages listener error:",n),n.code==="failed-precondition"){const c=C(y(h,"messages"),A("userId","==",t.uid));return M(c,Z=>{const j=[];Z.forEach(l=>{j.push({id:l.id,...l.data()})}),j.sort((l,S)=>{var m,U,x,E;const $=((U=(m=l.createdAt)==null?void 0:m.toDate)==null?void 0:U.call(m))||new Date(l.createdAt||0),B=((E=(x=S.createdAt)==null?void 0:x.toDate)==null?void 0:E.call(x))||new Date(S.createdAt||0);return $-B}),N(j),f(!1)})}a("Chyba při načítání zpráv: "+n.message),f(!1)});return()=>r()},[t]);const z=async s=>{if(s.preventDefault(),!(!o.trim()||d)){if(!t){a("Nejste přihlášeni");return}w(!0),a(null);try{const r={userId:t.uid,userEmail:t.email,userName:(g==null?void 0:g.name)||"Uživatel",message:o.trim(),isFromUser:!0,createdAt:new Date,isRead:!1};await O(y(h,"messages"),r),u(""),a(null)}catch(r){console.error("Error sending message:",r),r.code==="permission-denied"?a("Nemáte oprávnění k odeslání zprávy. Zkontrolujte přihlášení."):r.code==="unauthenticated"?a("Nejste přihlášeni. Přihlaste se znovu."):a("Chyba při odesílání zprávy: "+r.message)}finally{w(!1)}}},R=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleString("cs-CZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return I?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Načítání konverzace..."})]})}):e.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-100 sticky top-0 z-40 shadow-sm",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center h-16",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(F,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Chat s podporou"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Jsme tu pro tebe!"})]})]})})})}),e.jsxs("div",{className:"flex-1 max-w-4xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(V,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-red-900 mb-1",children:"Chyba"}),e.jsx("p",{className:"text-sm text-red-700",children:k}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>a(null),className:"mt-3 text-red-600 border-red-300 hover:bg-red-50",children:"Zavřít"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-100 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ee,{className:"w-5 h-5 text-pink-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Podpora a pomoc"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Můžeš se ptát na cokoliv ohledně péče o pleť, aplikace nebo svého pokroku. Odpovídáme obvykle do 24 hodin."})]})]})}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"h-[500px] overflow-y-auto",children:p.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Zatím žádné zprávy"}),e.jsx("p",{className:"text-gray-500",children:"Pošli svou první zprávu a začni konverzaci!"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[p.map(s=>e.jsxs("div",{className:`flex items-end space-x-3 ${s.isFromUser?"flex-row-reverse space-x-reverse":""}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.isFromUser?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-gray-100 text-gray-600"}`,children:s.isFromUser?e.jsx(G,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})})}),e.jsxs("div",{className:`max-w-xs lg:max-w-md ${s.isFromUser?"text-right":"text-left"}`,children:[e.jsx("div",{className:`inline-block rounded-2xl px-4 py-3 ${s.isFromUser?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-gray-100 text-gray-900"}`,children:e.jsx("p",{className:"text-sm leading-relaxed",children:s.message})}),e.jsxs("div",{className:`flex items-center mt-1 space-x-1 text-xs text-gray-400 ${s.isFromUser?"justify-end":"justify-start"}`,children:[e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{children:R(s.createdAt)})]})]})]},s.id)),e.jsx("div",{ref:D})]})})}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-4",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(J,{placeholder:"Napiš svou zprávu...",value:o,onChange:s=>u(s.target.value),className:"min-h-0 resize-none border-gray-200 focus:border-pink-300 focus:ring-pink-200",rows:2,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),z(s))}})}),e.jsx(b,{type:"submit",disabled:!o.trim()||d||!t,className:"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 px-6 self-end",children:d?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(W,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Stiskni Enter pro odeslání, Shift+Enter pro nový řádek"}),t&&e.jsxs("span",{className:"text-green-600 font-medium",children:["✓ Přihlášen jako: ",t.email]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Rychlé zprávy:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Jak mám pečovat o pleť?","Mám problém s aplikací","Kdy uvidím výsledky?","Potřebuji pomoc s fotografováním"].map(s=>e.jsx(b,{variant:"outline",size:"sm",onClick:()=>u(s),className:"text-xs border-gray-200 hover:border-pink-300 hover:bg-pink-50",disabled:d,children:s},s))})]})]})]})}export{xe as default};
