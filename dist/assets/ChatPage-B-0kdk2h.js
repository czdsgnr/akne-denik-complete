import{c as R,a as i,j as e}from"./createLucideIcon-CQGyNZ_Q.js";import{u as Z,q as D,o as $,w as z,c as g,i as S,B as v,k as B,e as K,d as m,f as L}from"./button-Dt3GSqWm.js";import{T as J}from"./textarea-C-ARTD2a.js";import{M as U}from"./message-square-9u4AbJ0T.js";import{C as Q}from"./circle-alert-tL62Yvf5.js";import{U as _}from"./user-BAHeOp9i.js";import{S as q,a as O}from"./shield-sUPv_6ne.js";import{C as V}from"./clock-Bae6WcDb.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],H=R("info",G);function ie(){const{user:r}=Z(),[x,j]=i.useState([]),[o,h]=i.useState(""),[E,u]=i.useState(!0),[d,b]=i.useState(!1),[C,A]=i.useState(null),[y,t]=i.useState(null),N=i.useRef(null),M=()=>{N.current?.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{M()},[x]),i.useEffect(()=>{(async()=>{if(r)try{const a=await B(K(m,"users",r.uid));if(a.exists()){const n=a.data();A(n)}else t("Uživatelská data nenalezena. Zkuste se znovu přihlásit.")}catch(a){console.error("Error loading user data:",a),t("Chyba při načítání uživatelských dat: "+a.message)}})()},[r]),i.useEffect(()=>{if(!r)return;const s=D(g(m,"messages"),z("userId","==",r.uid),$("createdAt","asc")),a=S(s,n=>{const c=[];n.forEach(p=>{c.push({id:p.id,...p.data()})}),j(c),u(!1),t(null)},n=>{if(console.error("Messages listener error:",n),n.code==="failed-precondition"){const c=D(g(m,"messages"),z("userId","==",r.uid));return S(c,I=>{const f=[];I.forEach(l=>{f.push({id:l.id,...l.data()})}),f.sort((l,k)=>{const P=l.createdAt?.toDate?.()||new Date(l.createdAt||0),T=k.createdAt?.toDate?.()||new Date(k.createdAt||0);return P-T}),j(f),u(!1)})}t("Chyba při načítání zpráv: "+n.message),u(!1)});return()=>a()},[r]);const w=async s=>{if(s.preventDefault(),!(!o.trim()||d)){if(!r){t("Nejste přihlášeni");return}b(!0),t(null);try{const a={userId:r.uid,userEmail:r.email,userName:C?.name||"Uživatel",message:o.trim(),isFromUser:!0,createdAt:new Date,isRead:!1};await L(g(m,"messages"),a),h(""),t(null)}catch(a){console.error("Error sending message:",a),a.code==="permission-denied"?t("Nemáte oprávnění k odeslání zprávy. Zkontrolujte přihlášení."):a.code==="unauthenticated"?t("Nejste přihlášeni. Přihlaste se znovu."):t("Chyba při odesílání zprávy: "+a.message)}finally{b(!1)}}},F=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleString("cs-CZ",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return E?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Načítání konverzace..."})]})}):e.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-100 sticky top-0 z-40 shadow-sm",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center h-16",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(U,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Chat s podporou"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Jsme tu pro tebe!"})]})]})})})}),e.jsxs("div",{className:"flex-1 max-w-4xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-red-900 mb-1",children:"Chyba"}),e.jsx("p",{className:"text-sm text-red-700",children:y}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>t(null),className:"mt-3 text-red-600 border-red-300 hover:bg-red-50",children:"Zavřít"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-100 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(H,{className:"w-5 h-5 text-pink-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Podpora a pomoc"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Můžeš se ptát na cokoliv ohledně péče o pleť, aplikace nebo svého pokroku. Odpovídáme obvykle do 24 hodin."})]})]})}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"h-[500px] overflow-y-auto",children:x.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Zatím žádné zprávy"}),e.jsx("p",{className:"text-gray-500",children:"Pošli svou první zprávu a začni konverzaci!"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[x.map(s=>e.jsxs("div",{className:`flex items-end space-x-3 ${s.isFromUser?"flex-row-reverse space-x-reverse":""}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.isFromUser?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-gray-100 text-gray-600"}`,children:s.isFromUser?e.jsx(_,{className:"w-4 h-4"}):e.jsx(q,{className:"w-4 h-4"})})}),e.jsxs("div",{className:`max-w-xs lg:max-w-md ${s.isFromUser?"text-right":"text-left"}`,children:[e.jsx("div",{className:`inline-block rounded-2xl px-4 py-3 ${s.isFromUser?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-gray-100 text-gray-900"}`,children:e.jsx("p",{className:"text-sm leading-relaxed",children:s.message})}),e.jsxs("div",{className:`flex items-center mt-1 space-x-1 text-xs text-gray-400 ${s.isFromUser?"justify-end":"justify-start"}`,children:[e.jsx(V,{className:"w-3 h-3"}),e.jsx("span",{children:F(s.createdAt)})]})]})]},s.id)),e.jsx("div",{ref:N})]})})}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-4",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(J,{placeholder:"Napiš svou zprávu...",value:o,onChange:s=>h(s.target.value),className:"min-h-0 resize-none border-gray-200 focus:border-pink-300 focus:ring-pink-200",rows:2,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),w(s))}})}),e.jsx(v,{type:"submit",disabled:!o.trim()||d||!r,className:"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 px-6 self-end",children:d?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(O,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Stiskni Enter pro odeslání, Shift+Enter pro nový řádek"}),r&&e.jsxs("span",{className:"text-green-600 font-medium",children:["✓ Přihlášen jako: ",r.email]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Rychlé zprávy:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Jak mám pečovat o pleť?","Mám problém s aplikací","Kdy uvidím výsledky?","Potřebuji pomoc s fotografováním"].map(s=>e.jsx(v,{variant:"outline",size:"sm",onClick:()=>h(s),className:"text-xs border-gray-200 hover:border-pink-300 hover:bg-pink-50",disabled:d,children:s},s))})]})]})]})}export{ie as default};
